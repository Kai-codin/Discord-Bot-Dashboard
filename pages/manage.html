<!DOCTYPE html>
<html lang="en">

<head>
    <title>Manage Apps - Bot Panel</title>
    <link rel="stylesheet" href="../file/index.css" />
    <link rel="icon" href="../file/favicon.png" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="//unicons.iconscout.com/release/v4.0.0/css/line.css" />
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../file/swal-dark.js"></script>
    <script src="//unpkg.com/@popperjs/core@2"></script>
    <script src="//unpkg.com/tippy.js@6"></script>
    <meta charset="UTF-8" />
</head>

<body>
    <div id="sidebar"><script src="/file/sidebar.js"></script></div>
    
    <main class="main-content">
        <div class="page-header">
            <div>
                <h1 class="page-title"><i class="uil uil-setting"></i> Manage Applications</h1>
                <p class="page-subtitle">Configure and manage your bot applications</p>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
            <!-- Application Settings Card -->
            <div class="card animate-fadeIn">
                <div class="card-header">
                    <h2 class="card-title"><i class="uil uil-cog"></i> Application Settings</h2>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Select Application</label>
                    <select id="manage_apps_select">
                        <option value="">-- Select an application --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Update Main Entry</label>
                    <input type="text" id="update_app_entry" placeholder="index.js or bot.py" />
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="update_main()">
                        <i class="uil uil-save"></i> Update Entry
                    </button>
                    <button class="btn btn-secondary" onclick="install_dependencies()" tip="Install all required modules">
                        <i class="uil uil-package"></i> Install Packages
                    </button>
                </div>
                
                <!-- Git Sync Section -->
                <div id="git_sync_section" style="display: none; margin-top: 1.5rem; padding-top: 1.25rem; border-top: 1px solid var(--border-color);">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <i class="uil uil-github" style="font-size: 1.25rem; color: var(--text-secondary);"></i>
                        <div>
                            <p style="font-weight: 500; color: var(--text-primary);">Git Repository</p>
                            <p id="git_remote_url" style="font-size: 0.75rem; color: var(--text-muted);">Loading...</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                        <span class="badge badge-primary" id="git_branch_badge">main</span>
                        <span id="git_last_commit" style="font-size: 0.75rem; color: var(--text-muted);"></span>
                    </div>
                    <button class="btn btn-primary" onclick="syncSelectedApp()">
                        <i class="uil uil-sync"></i> Sync from GitHub
                    </button>
                </div>
            </div>
            
            <!-- Package Installation Card -->
            <div class="card animate-fadeIn">
                <div class="card-header">
                    <h2 class="card-title"><i class="uil uil-box"></i> Package Manager</h2>
                </div>
                
                <!-- JavaScript Package Section -->
                <div id="js_package_section">
                    <div class="form-group">
                        <label class="form-label">Install Node Package</label>
                        <input type="text" id="download_package_box" placeholder="e.g., discord.js" />
                        <p class="form-hint">Enter the npm package name to install</p>
                    </div>
                    <button class="btn btn-primary" onclick="download_package()">
                        <i class="uil uil-download-alt"></i> Install NPM Package
                    </button>
                </div>
                
                <!-- Python Package Section -->
                <div id="py_package_section" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Install Python Package</label>
                        <input type="text" id="download_pip_package_box" placeholder="e.g., discord.py" />
                        <p class="form-hint">Enter the pip package name to install</p>
                    </div>
                    <button class="btn btn-success" onclick="download_pip_package()">
                        <i class="uil uil-download-alt"></i> Install Pip Package
                    </button>
                </div>
            </div>
            
            <!-- Delete Application Card -->
            <div class="card animate-fadeIn">
                <div class="card-header">
                    <h2 class="card-title" style="color: var(--danger);"><i class="uil uil-trash-alt"></i> Danger Zone</h2>
                </div>
                
                <div class="alert alert-danger" style="margin-bottom: 1rem;">
                    <i class="uil uil-exclamation-triangle"></i>
                    <div>
                        <strong>Warning:</strong> Deleting an application is permanent and cannot be undone.
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Select Application to Delete</label>
                    <select id="delete_app_box">
                        <option value="">-- Select an application --</option>
                    </select>
                </div>
                
                <button class="btn btn-danger" onclick="delete_app()">
                    <i class="uil uil-trash"></i> Delete Application
                </button>
            </div>
        </div>
    </main>
</body>

<script src="../file/index.js"></script>
<script>
    // Check git status when app is selected
    document.getElementById('manage_apps_select').addEventListener('change', async function() {
        const appName = this.value;
        const gitSection = document.getElementById('git_sync_section');
        
        if (!appName) {
            gitSection.style.display = 'none';
            return;
        }
        
        try {
            const status = await checkGitStatus(appName);
            
            if (status.Success && status.IsGitRepo) {
                gitSection.style.display = 'block';
                document.getElementById('git_remote_url').textContent = status.RemoteUrl || 'Unknown';
                document.getElementById('git_branch_badge').textContent = status.Branch || 'main';
                document.getElementById('git_last_commit').textContent = status.LastCommit || '';
                
                if (status.HasLocalChanges) {
                    document.getElementById('git_last_commit').innerHTML += ' <span class="badge badge-warning" style="font-size: 0.65rem;">Local changes</span>';
                }
            } else {
                gitSection.style.display = 'none';
            }
        } catch (err) {
            console.error('Error checking git status:', err);
            gitSection.style.display = 'none';
        }
    });
    
    function syncSelectedApp() {
        const appName = document.getElementById('manage_apps_select').value;
        if (appName) {
            sync_repo(appName);
        } else {
            Err('Please select an application first');
        }
    }
</script>

</html>